Ÿ
oC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Services\RiskEvaluationService.cs
	namespace 	
RiskService
 
. 
Services 
{ 
public 

class !
RiskEvaluationService &
{ 
public  
RiskEvaluationResult #
EvaluateRisk$ 0
(0 1
UserData1 9
userData: B
,B C
EnvironmentalDataD U
environmentalDataV g
)g h
{ 	
string

 
	riskLevel

 
=

 
$str

 $
;

$ %
var 
recommendations 
=  !
new" %
List& *
<* +
string+ 1
>1 2
(2 3
)3 4
;4 5
if 
( 
environmentalData !
.! "
Temperature" -
>. /
$num0 2
||3 5
environmentalData6 G
.G H
AirQualityIndexH W
>X Y
$numZ ]
)] ^
{ 
	riskLevel 
= 
$str "
;" #
recommendations 
.  
Add  #
(# $
$str$ G
)G H
;H I
recommendations 
.  
Add  #
(# $
$str$ ;
); <
;< =
} 
return 
new  
RiskEvaluationResult +
{ 
	RiskLevel 
= 
	riskLevel %
,% &
Recommendations 
=  !
recommendations" 1
.1 2
ToArray2 9
(9 :
): ;
} 
; 
} 	
} 
} ”
XC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
	AddScoped 
< !
RiskEvaluationService 0
>0 1
(1 2
)2 3
;3 4
builder 
. 
Services 
. 
	AddScoped 
< 
WeatherDataProvider .
>. /
(/ 0
)0 1
;1 2
var 
connectionString 
= 
builder 
. 
Configuration ,
., -
GetConnectionString- @
(@ A
$strA T
)T U
??V X
Environment "
." #"
GetEnvironmentVariable# 9
(9 :
$str: O
)O P
;P Q
builder 
. 
Services 
. 
AddDbContext 
< 
RiskDbContext +
>+ ,
(, -
options- 4
=>5 7
options 
. 
	UseSqlite 
( 
connectionString &
)& '
)' (
;( )
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
using 
( 
var 

scope 
= 
app 
. 
Services 
.  
CreateScope  +
(+ ,
), -
)- .
{ 
var 
	dbContext 
= 
scope 
. 
ServiceProvider )
.) *
GetRequiredService* <
<< =
RiskDbContext= J
>J K
(K L
)L M
;M N
try 
{ 
await 
	dbContext 
. 
Database  
.  !
MigrateAsync! -
(- .
). /
;/ 0
Console 
. 
	WriteLine 
( 
$str @
)@ A
;A B
} 
catch   	
(  
 
	Exception   
ex   
)   
{!! 
Console"" 
."" 
	WriteLine"" 
("" 
$""" 
$str"" :
{"": ;
ex""; =
.""= >
Message""> E
}""E F
"""F G
)""G H
;""H I
}## 
}$$ 
app'' 
.'' 

UseRouting'' 
('' 
)'' 
;'' 
app(( 
.(( 
MapControllers(( 
((( 
)(( 
;(( 
await++ 
app++ 	
.++	 

RunAsync++
 
(++ 
)++ 
;++ •
`C:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Models\UserData.cs
	namespace 	
RiskService
 
. 
Models 
{ 
public 

class 
UserData 
{ 
public 
int 
Age 
{ 
get 
; 
set !
;! "
}# $
public 
required 
string 
[ 
]  
MedicalConditions! 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
} 
} ­

bC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Models\RiskResult.cs
	namespace 	
RiskService
 
. 
Models 
{ 
public 

class 

RiskResult 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
required 
string 
Name #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
required 
string 
Description *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
required		 
string		 
	RiskLevel		 (
{		) *
get		+ .
;		. /
set		0 3
;		3 4
}		5 6
public

 
required

 
string

 
Recommendations

 .
{

/ 0
get

1 4
;

4 5
set

6 9
;

9 :
}

; <
} 
} Ê
lC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Models\RiskEvaluationResult.cs
	namespace 	
RiskService
 
. 
Models 
{ 
public 

class  
RiskEvaluationResult %
{ 
public 
required 
string 
	RiskLevel (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
required 
string 
[ 
]  
Recommendations! 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
} 
} •
iC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Models\EnvironmentalData.cs
	namespace 	
RiskService
 
. 
Models 
{ 
public 

class 
EnvironmentalData "
{ 
public 
double 
Temperature !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
double 
Humidity 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
AirQualityIndex "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
}		 ³
{C:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Migrations\20250409014847_InitialMigration.cs
	namespace 	
RiskService
 
. 

Migrations  
{ 
public		 

partial		 
class		 
InitialMigration		 )
:		* +
	Migration		, 5
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
falseX ]
)] ^
,^ _
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
	maxLengthE N
:N O
$numP S
,S T
nullableU ]
:] ^
false_ d
)d e
,e f
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
,T U
defaultValueSqlV e
:e f
$strg z
)z {
,{ |
	RiskLevel 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; A
,A B
nullableC K
:K L
falseM R
)R S
,S T
Recommendations #
=$ %
table& +
.+ ,
Column, 2
<2 3
string3 9
>9 :
(: ;
type; ?
:? @
$strA G
,G H
nullableI Q
:Q R
falseS X
)X Y
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
} 	
	protected!! 
override!! 
void!! 
Down!!  $
(!!$ %
MigrationBuilder!!% 5
migrationBuilder!!6 F
)!!F G
{"" 	
migrationBuilder## 
.## 
	DropTable## &
(##& '
name$$ 
:$$ 
$str$$ #
)$$# $
;$$$ %
}%% 	
}&& 
}'' ­
aC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\DTOs\UserDataDTO.cs
	namespace 	
RiskService
 
. 
DTOs 
{ 
public 

class 
UserDataDto 
{ 
public 
required 
int 
Age 
{  !
get" %
;% &
set' *
;* +
}, -
public 
required 
string 
[ 
]  
MedicalConditions! 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
} 
} ¶
gC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\DTOs\RiskEvaluationDto.cs
	namespace 	
RiskService
 
. 
DTOs 
{ 
public 

class 
RiskEvaluationDto "
{ 
public 
required 
UserDataDto #
UserData$ ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
required  
EnvironmentalDataDto ,
EnvironmentalData- >
{? @
getA D
;D E
setF I
;I J
}K L
} 
} Ä
jC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\DTOs\EnvironmentalDataDto.cs
	namespace 	
RiskService
 
. 
DTOs 
{ 
public 

class  
EnvironmentalDataDto %
{ 
public 
double 
? 
Temperature "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
double 
? 
Humidity 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 
? 
AirQualityIndex #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
}		 ³$
iC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Data\WeatherDataProvider.cs
	namespace 	
RiskService
 
. 
Data 
{ 
public		 

class		 
WeatherDataProvider		 $
{

 
private 
readonly 
string 
_baseUrl  (
;( )
private 
readonly 
string 
_apiKey  '
;' (
public 
WeatherDataProvider "
(" #
IConfiguration# 1
configuration2 ?
)? @
{ 	
_baseUrl 
= 
configuration $
[$ %
$str% 9
]9 :
?? 
throw 
new %
InvalidOperationException 6
(6 7
$str7 P
)P Q
;Q R
_apiKey 
= 
Environment !
.! ""
GetEnvironmentVariable" 8
(8 9
$str9 J
)J K
?? 
throw 
new %
InvalidOperationException 6
(6 7
$str	7 Š
)
Š ‹
;
‹ Œ
} 	
public 
async 
Task 
< 
EnvironmentalData +
>+ ,
GetWeatherDataAsync- @
(@ A
stringA G
locationH P
)P Q
{ 	
var 
client 
= 
new 

RestClient '
(' (
_baseUrl( 0
)0 1
;1 2
var 
request 
= 
new 
RestRequest )
() *
)* +
. 
AddQueryParameter "
(" #
$str# &
,& '
location( 0
)0 1
. 
AddQueryParameter "
(" #
$str# *
,* +
_apiKey, 3
)3 4
;4 5
var 
response 
= 
await  
client! '
.' (
GetAsync( 0
(0 1
request1 8
)8 9
;9 :
if   
(   
!   
response   
.   
IsSuccessful   &
||  ' )
string  * 0
.  0 1
IsNullOrEmpty  1 >
(  > ?
response  ? G
.  G H
Content  H O
)  O P
)  P Q
{!! 
throw"" 
new"" %
InvalidOperationException"" 3
(""3 4
$str""4 j
)""j k
;""k l
}## 
JObject%% 
?%% 
data%% 
;%% 
try&& 
{'' 
data(( 
=(( 
JObject(( 
.(( 
Parse(( $
((($ %
response((% -
.((- .
Content((. 5
)((5 6
;((6 7
})) 
catch** 
(** 
JsonReaderException** &
)**& '
{++ 
throw,, 
new,, %
InvalidOperationException,, 3
(,,3 4
$str,,4 _
),,_ `
;,,` a
}-- 
if// 
(// 
data// 
[// 
$str// 
]// 
==// 
null//  $
)//$ %
{00 
throw11 
new11 %
InvalidOperationException11 3
(113 4
$str114 g
)11g h
;11h i
}22 
return44 
new44 
EnvironmentalData44 (
{55 
Temperature66 
=66 
(66 
double66 %
)66% &
data66& *
[66* +
$str66+ 1
]661 2
!662 3
[663 4
$str664 :
]66: ;
!66; <
,66< =
Humidity77 
=77 
(77 
double77 "
)77" #
data77# '
[77' (
$str77( .
]77. /
!77/ 0
[770 1
$str771 ;
]77; <
!77< =
,77= >
AirQualityIndex88 
=88  !
data88" &
[88& '
$str88' -
]88- .
!88. /
[88/ 0
$str880 5
]885 6
!=887 9
null88: >
?88? @
(88A B
int88B E
)88E F
data88F J
[88J K
$str88K Q
]88Q R
!88R S
[88S T
$str88T Y
]88Y Z
!88Z [
:88\ ]
$num88^ `
}99 
;99 
}:: 	
};; 
}<< ¯
cC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Data\RiskDbContext.cs
	namespace 	
RiskService
 
. 
Data 
{ 
public 

class 
RiskDbContext 
:  
	DbContext! *
{ 
public 
RiskDbContext 
( 
DbContextOptions -
<- .
RiskDbContext. ;
>; <
options= D
)D E
:F G
baseH L
(L M
optionsM T
)T U
{V W
}X Y
public 
DbSet 
< 

RiskResult 
>  
RiskResults! ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
base 
. 
OnModelCreating  
(  !
modelBuilder! -
)- .
;. /
modelBuilder 
. 
Entity 
<  

RiskResult  *
>* +
(+ ,
entity, 2
=>3 5
{ 
entity 
. 
ToTable 
( 
$str ,
), -
;- .
entity 
. 
HasKey 
( 
e 
=>  "
e# $
.$ %
Id% '
)' (
;( )
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Name' +
)+ ,
., -

IsRequired- 7
(7 8
)8 9
.9 :
HasMaxLength: F
(F G
$numG J
)J K
;K L
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Description' 2
)2 3
.3 4
HasMaxLength4 @
(@ A
$numA D
)D E
;E F
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
	CreatedAt' 0
)0 1
.1 2
HasDefaultValueSql2 D
(D E
$strE X
)X Y
;Y Z
} 
) 
; 
} 	
} 
} ¼+
kC:\Users\Juan Jimenez\Desktop\Microservicios\packages\dotnet-risk\RiskService\Controllers\RiskController.cs
	namespace 	
RiskService
 
. 
Controllers !
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
public 

class 
RiskController 
:  !
ControllerBase" 0
{ 
private 
readonly !
RiskEvaluationService .
_riskService/ ;
;; <
private 
readonly 
RiskDbContext &

_dbContext' 1
;1 2
public 
RiskController 
( !
RiskEvaluationService 3
riskService4 ?
,? @
RiskDbContextA N
	dbContextO X
)X Y
{ 	
_riskService 
= 
riskService &
;& '

_dbContext 
= 
	dbContext "
;" #
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
IActionResult 
EvaluateRisk )
() *
[* +
FromBody+ 3
]3 4
RiskEvaluationDto5 F
requestG N
)N O
{ 	
if 
( 
request 
. 
UserData  
==! #
null$ (
||) +
request 
. 
EnvironmentalData )
==* ,
null- 1
||2 4
! 
request 
. 
EnvironmentalData *
.* +
Temperature+ 6
.6 7
HasValue7 ?
||@ B
! 
request 
. 
EnvironmentalData *
.* +
Humidity+ 3
.3 4
HasValue4 <
||= ?
! 
request 
. 
EnvironmentalData *
.* +
AirQualityIndex+ :
.: ;
HasValue; C
)C D
{ 
return   

BadRequest   !
(  ! "
$str  " Z
)  Z [
;  [ \
}!! 
var$$ 
userData$$ 
=$$ 
new$$ 
UserData$$ '
{%% 
Age&& 
=&& 
request&& 
.&& 
UserData&& &
.&&& '
Age&&' *
,&&* +
MedicalConditions'' !
=''" #
request''$ +
.''+ ,
UserData'', 4
.''4 5
MedicalConditions''5 F
}(( 
;(( 
var** 
environmentalData** !
=**" #
new**$ '
EnvironmentalData**( 9
{++ 
Temperature,, 
=,, 
request,, %
.,,% &
EnvironmentalData,,& 7
.,,7 8
Temperature,,8 C
.,,C D
Value,,D I
,,,I J
Humidity-- 
=-- 
request-- "
.--" #
EnvironmentalData--# 4
.--4 5
Humidity--5 =
.--= >
Value--> C
,--C D
AirQualityIndex.. 
=..  !
request.." )
...) *
EnvironmentalData..* ;
...; <
AirQualityIndex..< K
...K L
Value..L Q
}// 
;// 
var22 
result22 
=22 
_riskService22 %
.22% &
EvaluateRisk22& 2
(222 3
userData223 ;
,22; <
environmentalData22= N
)22N O
;22O P
var55 

riskResult55 
=55 
new55  

RiskResult55! +
{66 
Name77 
=77 
$str77 .
+77/ 0
DateTime771 9
.779 :
UtcNow77: @
.77@ A
ToString77A I
(77I J
$str77J V
)77V W
,77W X
Description88 
=88 
$str88 k
,88k l
	RiskLevel99 
=99 
result99 "
.99" #
	RiskLevel99# ,
,99, -
Recommendations:: 
=::  !
string::" (
.::( )
Join::) -
(::- .
$str::. 2
,::2 3
result::4 :
.::: ;
Recommendations::; J
)::J K
,::K L
	CreatedAt;; 
=;; 
DateTime;; $
.;;$ %
UtcNow;;% +
}<< 
;<< 

_dbContext>> 
.>> 
RiskResults>> "
.>>" #
Add>># &
(>>& '

riskResult>>' 1
)>>1 2
;>>2 3

_dbContext?? 
.?? 
SaveChanges?? "
(??" #
)??# $
;??$ %
returnBB 
OkBB 
(BB 
resultBB 
)BB 
;BB 
}CC 	
[EE 	
HttpGetEE	 
(EE 
$strEE 
)EE 
]EE 
publicFF 
IActionResultFF 

GetResultsFF '
(FF' (
)FF( )
{GG 	
varII 
resultsII 
=II 

_dbContextII $
.II$ %
RiskResultsII% 0
.II0 1
ToListII1 7
(II7 8
)II8 9
;II9 :
returnJJ 
OkJJ 
(JJ 
resultsJJ 
)JJ 
;JJ 
}KK 	
}LL 
}MM 